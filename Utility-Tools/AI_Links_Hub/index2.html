<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Links Hub | Your Curated AI/ML Library</title>
    <meta name="description" content="A minimal, elegant single-page hub to collect and categorize helpful AI/ML/Data links with search, tags, routing, i18n, and JSON sync." />
    <meta property="og:title" content="AI Links Hub" />
    <meta property="og:description" content="All my AI/ML/Data resources in one place." />
    <meta property="og:type" content="website" />
    <meta name="theme-color" content="#0ea5e9" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100  100'><rect width='100' height='100' rx='22' fill='%230ea5e9'/><text x='50' y='58' text-anchor='middle' font-size='54' fill='white'>AI</text></svg>">

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'Vazirmatn', 'ui-sans-serif', 'system-ui'] },
            backgroundImage: {
              grid: 'radial-gradient(circle at 1px 1px, rgba(255,255,255,0.08) 1px, transparent 0)',
            },
            boxShadow: {
              glow: '0 0 1px rgba(34,211,238,.6), 0 0 24px rgba(14,165,233,.25)'
            }
          },
        },
      }
    </script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Vazirmatn:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
      /* --- Compact list styles for Books/Ebooks modal --- */
      .list-row{padding:.75rem 0;border-bottom:1px solid rgba(148,163,184,.25)}
      .list-row:last-child{border-bottom:0}
      .list-title{font-weight:700;line-height:1.2}
      .list-meta{font-size:.875rem;color:rgb(71,85,105)}
      .dark .list-meta{color:rgb(203,213,225)}
      .list-meta li{list-style:disc;margin-left:1.2rem}

      .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.08); }
      .dark .glass { background: rgba(255,255,255,.05); }
      .card:hover { transform: translateY(-2px); }
      .smooth { transition: all .2s ease; }
      ::-webkit-scrollbar { width: 10px; height: 10px; }
      ::-webkit-scrollbar-thumb { background: rgba(100,116,139,.5); border-radius: 10px; }
      ::-webkit-scrollbar-track { background: transparent; }
      .pill { font-size:10px; padding:.35rem .6rem; border-radius:9999px }
      details > summary { cursor:pointer }

      /* Unified modal behavior */
      .modal { position: fixed; inset: 0; display: none; }
      .modal.is-open { display: grid; place-items: center; }
    </style>
  </head>
  <body class="bg-slate-50 dark:bg-slate-950 text-slate-800 dark:text-slate-100 min-h-screen selection:bg-cyan-300/40 selection:text-slate-900">
    <!-- Background aesthetics -->
    <div class="pointer-events-none fixed inset-0 -z-10">
      <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-cyan-500/10 via-indigo-500/5 to-transparent"></div>
      <div class="absolute inset-0 bg-grid bg-[length:22px_22px]"></div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8">
      <!-- Header / Nav -->
      <header class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-2xl bg-cyan-500 text-white grid place-items-center font-extrabold shadow-glow">AI</div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">AI Links Hub</h1>
            <p id="subtitle" class="text-sm text-slate-600 dark:text-slate-400 mt-1">A personal library of helpful links; with search, tags & categories.</p>
          </div>
        </div>
        <nav class="flex items-center gap-2">
          <button data-route="links" class="route-btn smooth px-3 py-2 rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 text-sm">Links</button>
          <button data-route="guide" class="route-btn smooth px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-sm">Guide</button>
          <button id="langBtn" class="smooth px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-sm" title="Toggle language">FA / EN</button>
          <button id="exportBtn" class="smooth px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm">Export JSON</button>
          <button id="importBtn" class="smooth px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm">Import JSON</button>
          <input id="importInput" type="file" accept="application/json" class="hidden" />
          <button id="modeBtn" class="smooth px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm" title="Dark/Light">🌓</button>
          <a href="#add" class="smooth px-3 py-2 rounded-xl bg-cyan-500 hover:bg-cyan-600 text-white text-sm">+ Add</a>
        </nav>
      </header>

      <!-- Controls (Links route only) -->
      <section id="controls" class="glass rounded-2xl p-4 border border-slate-200/40 dark:border-white/5 mb-6">
        <div class="flex flex-col md:flex-row gap-3 md:items-center">
          <div class="relative flex-1">
            <input id="search" type="search" placeholder="Search title, description, tag or domain… (use tag:vision site:arxiv.org)" class="w-full rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-4 py-3 pr-10 focus:outline-none focus:ring-2 focus:ring-cyan-500/40">
            <span class="absolute right-3 top-2.5 text-slate-400">🔎</span>
          </div>
          <!-- Category dropdown -->
          <div class="flex items-center gap-2">
            <label for="categorySelect" class="text-xs text-slate-500 dark:text-slate-400">Category:</label>
            <select id="categorySelect" class="rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-3 py-2"></select>
          </div>
        </div>
        <div class="mt-3 text-xs text-slate-500 dark:text-slate-400" id="searchHelp">Tip: Combine text + operators like <code class="px-1 rounded bg-slate-200/60 dark:bg-slate-800">deep-learning tag:vision site:arxiv.org</code></div>
      </section>

      <!-- Featured -->
      <section id="featured" class="mt-8">
        <h2 class="text-lg font-bold mb-3" data-i18n="featuredTitle">Featured</h2>
        <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
          <!-- Google Colab -->
          <article class="card smooth rounded-2xl border border-slate-200 dark:border-slate-800 p-4 flex flex-col gap-2">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">Google Colab</h3>
              <span class="badge">Platform</span>
            </div>
            <p class="text-sm text-slate-600 dark:text-slate-300">Run notebooks in the cloud with GPUs.</p>
            <a href="https://colab.research.google.com" target="_blank" rel="noopener" class="text-cyan-600 dark:text-cyan-400 hover:underline text-sm">Open ↗</a>
          </article>

          <!-- GitHub -->
          <article class="card smooth rounded-2xl border border-slate-200 dark:border-slate-800 p-4 flex flex-col gap-2">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">GitHub</h3>
              <span class="badge">Platform</span>
            </div>
            <p class="text-sm text-slate-600 dark:text-slate-300">Host code, branches, and GitHub Pages.</p>
            <a href="https://github.com" target="_blank" rel="noopener" class="text-cyan-600 dark:text-cyan-400 hover:underline text-sm">Open ↗</a>
          </article>

          <!-- Books List (from books.json) -->
          <article id="featured-books" class="card smooth rounded-2xl border border-slate-200 dark:border-slate-800 p-4 flex flex-col gap-2 cursor-pointer">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">Books List</h3>
              <span class="badge">JSON</span>
            </div>
            <p class="text-sm text-slate-600 dark:text-slate-300">Browse curated books (from books.json).</p>
            <button class="text-cyan-600 dark:text-cyan-400 hover:underline text-sm text-left">Open list</button>
          </article>

          <!-- Ebooks (from ebooks.json) -->
          <article id="featured-ebooks" class="card smooth rounded-2xl border border-slate-200 dark:border-slate-800 p-4 flex flex-col gap-2 cursor-pointer">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">Ebooks</h3>
              <span class="badge">JSON</span>
            </div>
            <p class="text-sm text-slate-600 dark:text-slate-300">Open PDFs with rich metadata (from ebooks.json).</p>
            <button class="text-cyan-600 dark:text-cyan-400 hover:underline text-sm text-left">Open list</button>
          </article>
        </div>
      </section>

      <!-- Results info -->
      <div id="resultInfo" class="text-xs text-slate-500 dark:text-slate-400 mb-2">—</div>

      <!-- Links grid -->
      <main id="grid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></main>

      <!-- Add new link -->
      <section id="add" class="mt-10 glass rounded-2xl p-5 border border-slate-200/40 dark:border-white/5">
        <h2 class="font-bold text-lg mb-3" data-i18n="addTitle">Add a link</h2>
        <form id="addForm" class="grid sm:grid-cols-2 gap-3">
          <input name="title" required placeholder="Title" class="rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-4 py-3" />
          <input name="url" required type="url" placeholder="URL (https://…)" class="rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-4 py-3" />
          <input name="desc" placeholder="Short description" class="rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-4 py-3 sm:col-span-2" />
          <div class="sm:col-span-2 grid grid-cols-2 gap-3">
            <select name="category" class="rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-4 py-3">
              <option value="ai">AI / ML</option>
              <option value="data">Data / Viz</option>
              <option value="python">Python</option>
              <option value="papers">Papers</option>
              <option value="tools">Tools</option>
              <option value="career">Career</option>
            </select>
            <input name="tags" placeholder="Tags (comma-separated)" class="rounded-xl bg-white/80 dark:bg-slate-900/60 border border-slate-200 dark:border-slate-800 px-4 py-3" />
          </div>
          <button class="smooth mt-1 sm:col-span-2 px-4 py-3 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white">Save to LocalStorage</button>
        </form>
        <p class="text-xs text-slate-500 dark:text-slate-400 mt-3" id="storageNote">Data is stored in your browser. Use Export to back up JSON and keep it in Git.</p>
      </section>

      <!-- Footer -->
      <footer class="mt-10 text-center text-xs text-slate-500 dark:text-slate-400">
        Designed for AI learners — Minimal, glassy, and keyboard-friendly.
      </footer>
    </div>

    <!-- Card template -->
    <template id="cardTemplate">
      <article class="card smooth rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 p-4 flex flex-col gap-3">
        <div class="flex items-start justify-between gap-3">
          <div class="min-w-0">
            <h3 class="title font-bold leading-tight truncate"></h3>
            <p class="desc text-sm text-slate-600 dark:text-slate-400 line-clamp-2 mt-1"></p>
          </div>
          <div class="shrink-0 w-9 h-9 rounded-xl grid place-items-center bg-slate-100 dark:bg-slate-800 text-lg">🔗</div>
        </div>
        <div class="flex flex-wrap gap-1 tags"></div>
        <div class="flex items-center justify-between pt-2">
          <a class="url smooth text-cyan-600 dark:text-cyan-400 hover:underline text-sm break-all" target="_blank" rel="noopener">Open ↗</a>
          <div class="text-[10px] text-slate-500 dark:text-slate-400 domain"></div>
        </div>
        <div class="flex items-center justify-between">
          <a class="about smooth text-xs text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 cursor-pointer">About</a>
        </div>
      </article>
    </template>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
      <div class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 max-w-2xl w-[92%] p-6">
        <div class="flex items-start justify-between gap-3 mb-3">
          <h3 id="aboutTitle" class="font-extrabold text-lg"></h3>
          <button id="aboutClose" class="px-2 py-1 rounded-lg border border-slate-300 dark:border-slate-700">✕</button>
        </div>
        <p id="aboutDesc" class="text-sm text-slate-600 dark:text-slate-300 mb-3"></p>
        <div id="aboutLinks" class="grid gap-2"></div>
      </div>
    </div>

    <!-- List Modal (Books/Ebooks) -->
    <div id="listModal" class="modal">
      <div class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 max-w-3xl w-[92%] p-6 max-h-[80vh] overflow-y-auto">
        <div class="flex items-start justify-between gap-3 mb-3">
          <h3 id="listTitle" class="font-extrabold text-lg"></h3>
          <button id="listClose" class="px-2 py-1 rounded-lg border border-slate-300 dark:border-slate-700">✕</button>
        </div>
        <div id="listContainer" class="grid gap-4"></div>
      </div>
    </div>

    <script>
      /* ===================== i18n ===================== */
      const I18N = {
        en: {
          subtitle: 'A personal library of helpful links; with search, tags & categories.',
          searchPlaceholder: 'Search title, description, tag or domain… (use tag:vision site:arxiv.org)',
          tip: 'Tip: Combine text + operators like ',
          featuredTitle: 'Featured',
          addTitle: 'Add a link',
          storageNote: 'Data is stored in your browser. Use Export to back up JSON and keep it in Git.',
          guideTitle: 'How to use this hub',
          guideSync: 'Syncing with GitHub (JSON)',
          open: 'Open', about: 'About', links: 'Links', guide: 'Guide',
          count: (n, cat, q)=> `${n} results${cat!=='all'?` — category: ${cat}`:''}${q?` — query: “${q}”`:''}`,
        },
        fa: {
          subtitle: 'کتابخانه‌ای شخصی از لینک‌های مفید با جست‌وجو، تگ و دسته‌ها.',
          searchPlaceholder: 'جست‌وجوی عنوان، توضیح، تگ یا دامنه… (مثال: tag:vision site:arxiv.org)',
          tip: 'نکته: می‌توانی متن + عملگرها را ترکیب کنی مثل ',
          featuredTitle: 'ویژه',
          addTitle: 'افزودن لینک',
          storageNote: 'داده‌ها در مرورگر شما ذخیره می‌شود. با Export نسخهٔ JSON بگیرید و در Git نگه دارید.',
          guideTitle: 'راهنمای استفاده',
          guideSync: 'همگام‌سازی با گیت‌هاب (JSON)',
          open: 'باز کردن', about: 'درباره', links: 'لینک‌ها', guide: 'راهنما',
          count: (n, cat, q)=> `${n} لینک نمایش داده شد${cat!=='all'?` — دسته: ${cat}`:''}${q?` — جست‌وجو: “${q}”`:''}`,
        }
      };

      function setLang(lang){
        const dict = I18N[lang] || I18N.en;
        document.getElementById('subtitle').textContent = dict.subtitle;
        document.getElementById('search').placeholder = dict.searchPlaceholder;
        const el = document.getElementById('searchHelp');
        if (el) {
            el.innerHTML = dict.tip +
            '<code class="px-1 rounded bg-slate-200/60 dark:bg-slate-800">deep-learning tag:vision site:arxiv.org</code>';
        }

        document.querySelector('[data-i18n="featuredTitle"]').textContent = dict.featuredTitle;
        document.querySelector('[data-i18n="addTitle"]').textContent = dict.addTitle;
        document.getElementById('storageNote').textContent = dict.storageNote;
        document.querySelector('[data-i18n="guideTitle"]').textContent = dict.guideTitle;
        document.querySelector('[data-i18n="guideSync"]').textContent = dict.guideSync;
        document.querySelector('[data-route="links"]').textContent = dict.links;
        document.querySelector('[data-route="guide"]').textContent = dict.guide;
        document.documentElement.lang = (lang === 'fa' ? 'fa' : 'en');
        document.documentElement.dir  = (lang === 'fa' ? 'rtl' : 'ltr');
        localStorage.setItem('ai-lang', lang);
        state.lang = lang;
        render();
      }

      /* ===================== data & utils ===================== */
      const seedLinks = [
        { title: 'scikit-learn User Guide', url: 'https://scikit-learn.org/stable/user_guide.html', desc: 'Complete guide with practical examples.', category: 'ai', tags: ['ml','python','guide'], about: { notes: 'Great for classical ML, pipelines, preprocessing, and evaluation.', links: [ { label: 'API Reference', url: 'https://scikit-learn.org/stable/modules/classes.html' }, { label: 'Model Evaluation', url: 'https://scikit-learn.org/stable/modules/model_evaluation.html' }]}}
        ,{ title: 'NumPy Documentation', url: 'https://numpy.org/doc/stable/', desc: 'Arrays, broadcasting and performance.', category: 'python', tags: ['numpy','arrays','performance'], about: { notes: 'Foundation for scientific Python; focus on shapes, dtypes, and vectorization.', links: [ { label: 'User Guide', url: 'https://numpy.org/doc/stable/user/index.html' }, { label: 'Broadcasting', url: 'https://numpy.org/doc/stable/user/basics.broadcasting.html' }]}}
        ,{ title: 'Pandas User Guide', url: 'https://pandas.pydata.org/docs/user_guide/index.html', desc: 'DataFrames, IO, indexing, time series.', category: 'data', tags: ['pandas','dataframe','io'], about: { notes: 'Learn selection with .loc/.iloc, groupby, and joins for analysis workflows.', links: [ { label: 'Indexing', url: 'https://pandas.pydata.org/docs/user_guide/indexing.html' }, { label: 'Groupby', url: 'https://pandas.pydata.org/docs/user_guide/groupby.html' }]}}
        ,{ title: 'arXiv: cs.LG (recent)', url: 'https://arxiv.org/list/cs.LG/recent', desc: 'Latest ML research preprints.', category: 'papers', tags: ['arxiv','research','ml'], about: { notes: 'Track trends and new methods; read abstracts to shortlist.', links: [ { label: 'arXiv search: vision', url: 'https://arxiv.org/search/?query=vision&searchtype=all&source=header' } ] }}
        ,{ title: 'Weights & Biases', url: 'https://wandb.ai/', desc: 'Experiment tracking and dashboards.', category: 'tools', tags: ['mlops','exp-tracking'], about: { notes: 'Log metrics/artifacts, compare runs, share results, and collaborate.', links: [ { label: 'W&B Docs', url: 'https://docs.wandb.ai/' } ] }}
        ,{ title: 'Awesome Machine Learning', url: 'https://github.com/josephmisiti/awesome-machine-learning', desc: 'Curated ML resources list.', category: 'ai', tags: ['awesome','curation'], about: { notes: 'A broad catalog; scan by language and domain.', links: [ { label: 'Contribute Guide', url: 'https://github.com/josephmisiti/awesome-machine-learning#contributing' } ] }}
        ,{ title: 'Matplotlib Tutorials', url: 'https://matplotlib.org/stable/tutorials/', desc: 'Plotting fundamentals and beyond.', category: 'data', tags: ['viz','matplotlib'], about: { notes: 'Understand figures/axes; practice consistent styling and labeling.', links: [ { label: 'Gallery', url: 'https://matplotlib.org/stable/gallery/index.html' } ] }}
        ,{ title: 'Eugeneyan.com — ML System Design', url: 'https://eugeneyan.com/writing/', desc: 'Production ML, data & engineering essays.', category: 'career', tags: ['career','system-design'], about: { notes: 'Industry-grade writings for designing robust ML systems.', links: [ { label: 'Recommended Reads', url: 'https://eugeneyan.com/tags/' } ] }}
        ,{ title: 'PyTorch Docs', url: 'https://pytorch.org/docs/stable/index.html', desc: 'Deep learning framework docs.', category: 'ai', tags: ['pytorch','dl','autograd'], about: { notes: 'Great tutorials and nn modules; check TorchVision for vision.', links:[{label:'TorchVision', url:'https://pytorch.org/vision/stable/index.html'}]}}
        ,{ title: 'TensorFlow Guide', url: 'https://www.tensorflow.org/guide', desc: 'Comprehensive TF guide.', category: 'ai', tags: ['tensorflow','dl'], about: { notes:'Keras high-level API; look at tf.data and SavedModel.', links:[{label:'Keras Docs', url:'https://keras.io/'}]}}
        ,{ title: 'SciPy Docs', url: 'https://docs.scipy.org/doc/scipy/', desc: 'Algorithms for scientific computing.', category: 'python', tags: ['scipy','opt','signal'], about: { notes:'Optimization, stats, signal processing; complements NumPy.', links:[{label:'Tutorial', url:'https://docs.scipy.org/doc/scipy/tutorial/'}]}}
        ,{ title: 'Seaborn Tutorials', url: 'https://seaborn.pydata.org/tutorial.html', desc: 'Statistical data visualization.', category: 'data', tags: ['seaborn','viz'], about: { notes:'High-level charts over Matplotlib; explore FacetGrid & catplot.', links:[{label:'Gallery', url:'https://seaborn.pydata.org/examples/index.html'}]}}
        ,{ title: 'statsmodels Docs', url: 'https://www.statsmodels.org/stable/', desc: 'Classical statistics & econometrics.', category: 'ai', tags: ['stats','time-series'], about: { notes:'GLM, ARIMA, and inference tools with summaries.', links:[{label:'Examples', url:'https://www.statsmodels.org/stable/examples/index.html'}]}}
        ,{ title: 'Kaggle Learn', url: 'https://www.kaggle.com/learn', desc: 'Short hands-on courses.', category: 'career', tags: ['kaggle','learn'], about: { notes:'Practical tracks on ML, Pandas, DL.', links:[{label:'Competitions', url:'https://www.kaggle.com/competitions'}]}}
        ,{ title: 'fast.ai Courses', url: 'https://course.fast.ai/', desc: 'Top-down practical deep learning.', category: 'ai', tags: ['fastai','dl','course'], about: { notes:'Great for practitioners; start with vision then nlp/tabular.', links:[{label:'Docs', url:'https://docs.fast.ai/'}]}}
        ,{ title: 'Hugging Face — Transformers', url: 'https://huggingface.co/docs/transformers/index', desc: 'NLP/vision/audio Transformers.', category: 'ai', tags: ['hf','transformers'], about:{notes:'Pretrained models, pipelines, and fine-tuning guides.', links:[{label:'HF Hub', url:'https://huggingface.co/'}]}}
      ];

      const $  = (s, r=document)=> r.querySelector(s);
      const $$ = (s, r=document)=> [...r.querySelectorAll(s)];
      const cardTpl = $('#cardTemplate');

      const formatDomain = (url)=>{ try{ return new URL(url).hostname.replace(/^www\./,''); } catch{ return '' } };
      const applyTheme   = (mode)=>{ const root = document.documentElement; (mode==='dark'?root.classList.add('dark'):root.classList.remove('dark')); localStorage.setItem('theme', mode); };

      function parseHash(){
        const h = new URLSearchParams((location.hash||'').replace(/^#/, ''));
        return { route: h.get('route') || 'links', q: h.get('q') || '', cat: h.get('cat') || 'all' };
      }
      function setHash(p){
        const params = new URLSearchParams();
        params.set('route', p.route ?? state.route ?? 'links');
        if (p.q  !== undefined) params.set('q',  p.q);
        if (p.cat!== undefined) params.set('cat', p.cat);
        location.hash = params.toString();
      }
      const save = (data)=> localStorage.setItem('ai-links', JSON.stringify(data));
      const loadLocal = ()=> { const raw = localStorage.getItem('ai-links'); return raw ? JSON.parse(raw) : seedLinks; };

      async function loadRemote(){
        try {
          const res = await fetch('ai-links.json', { cache: 'no-store' });
          if (!res.ok) throw 0;
          const j = await res.json();
          if (!Array.isArray(j)) throw 0;
          return j;
        } catch { return null; }
      }

      /* ===================== categories (dropdown) ===================== */
      const DEFAULT_CATEGORIES = [
        { id: 'ai',     label: 'AI / ML' },
        { id: 'python', label: 'Python' },
        { id: 'data',   label: 'Data / Viz' },
        { id: 'papers', label: 'Papers' },
        { id: 'tools',  label: 'Tools' },
        { id: 'career', label: 'Career' },
      ];
      async function loadCategoriesFromJSON(){
        try{
          const res = await fetch('filters.json', { cache: 'no-store' });
          if(!res.ok) throw 0;
          const j = await res.json();
          const arr = Array.isArray(j) ? j : [];
          return arr.map(x => (typeof x==='string') ? { id:x, label:x[0].toUpperCase()+x.slice(1) }
                      : (x&&typeof x.id==='string') ? { id:x.id, label:x.label||x.id } : null).filter(Boolean);
        }catch{ return DEFAULT_CATEGORIES; }
      }
      async function initCategoryDropdown(){
        const select = $('#categorySelect'); if(!select) return;
        const cats = await loadCategoriesFromJSON();
        select.innerHTML = '';
        select.append(new Option('All','all'));
        cats.forEach(c=> select.append(new Option(c.label, c.id)));
        select.value = (state.category && (state.category==='all' || cats.some(c=>c.id===state.category)))
                      ? state.category : 'all';
        select.onchange = ()=>{ state.category = select.value; setHash({ cat: state.category }); render(); };
      }

      /* ===================== state & render ===================== */
      let state = { data: [], query: '', category: 'all', route: 'links', lang: localStorage.getItem('ai-lang')||'en' };

      function render(){
        const dict = I18N[state.lang] || I18N.en;
        $('#controls')?.classList.toggle('hidden', state.route!=='links');
        $('#guide')?.classList.toggle('hidden',    state.route!=='guide');
        $$('.route-btn').forEach(b=>{
          if (b.dataset.route===state.route){
            b.classList.add('bg-slate-900','text-white','dark:bg-white','dark:text-slate-900'); b.classList.remove('border');
          } else {
            b.classList.remove('bg-slate-900','text-white','dark:bg-white','dark:text-slate-900'); b.classList.add('border');
          }
        });

        const grid = $('#grid'); if (!grid) return;
        grid.innerHTML = '';
        const q = state.query.trim().toLowerCase();
        const activeCat = state.category;

        const filtered = (state.data||[]).filter(item=>{
          const inCat = activeCat==='all' || item.category===activeCat;
          const bag = [item.title, item.desc, item.url, (item.tags||[]).join(','), item.category].join(' ').toLowerCase();
          const tagMatches  = (q.match(/tag:([^\s]+)/g)||[]).every(t => (item.tags||[]).map(x=>x.toLowerCase()).includes(t.split(':')[1].toLowerCase()));
          const siteMatches = (q.match(/site:([^\s]+)/g)||[]).every(s => (item.url||'').toLowerCase().includes(s.split(':')[1].toLowerCase()));
          const plainQ = q.replace(/tag:[^\s]+/g,'').replace(/site:[^\s]+/g,'').trim();
          const textMatches = !plainQ || bag.includes(plainQ);
          return inCat && tagMatches && siteMatches && textMatches;
        });

        for (const item of filtered){
          const node = cardTpl.content.cloneNode(true);
          $('.title', node).textContent = item.title || '';
          $('.desc',  node).textContent = item.desc  || '';
          const a = $('.url', node);
          a.href = item.url || '#'; a.title = item.url || ''; a.textContent = (dict.open||'Open') + ' ↗';
          $('.domain', node).textContent = formatDomain(item.url||'');
          const tags = $('.tags', node);
          (item.tags||[]).forEach(t=>{
            const span = document.createElement('span');
            span.textContent = '#'+t;
            span.className = 'pill bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300';
            span.addEventListener('click',()=>{ $('#search').value=`tag:${t}`; state.query=`tag:${t}`; setHash({q:state.query}); render(); });
            tags.appendChild(span);
          });
          $('.about', node).textContent = dict.about;
          $('.about', node).addEventListener('click',()=>openAbout(item));
          grid.appendChild(node);
        }
        $('#resultInfo')?.replaceChildren(document.createTextNode((dict.count||I18N.en.count)(filtered.length, activeCat, state.query)));
      }

      function openAbout(item){
        $('#aboutTitle').textContent = item.title || '';
        $('#aboutDesc').textContent  = (item.about&&item.about.notes) || item.desc || '';
        const cont = $('#aboutLinks'); if (cont){ cont.innerHTML=''; ((item.about&&item.about.links)||[]).forEach(l=>{
          const a = document.createElement('a');
          a.href = l.url; a.target='_blank'; a.rel='noopener';
          a.textContent = '• ' + l.label + ' ↗';
          a.className = 'text-sm text-cyan-600 dark:text-cyan-400 hover:underline';
          cont.appendChild(a);
        });}
        document.getElementById('aboutModal').classList.add('is-open');
      }

      /* ===================== Featured: books / ebooks ===================== */
      async function getJSON(url){
        try{ const r = await fetch(url, { cache: 'no-store' }); if(!r.ok) return []; const j = await r.json(); return Array.isArray(j)?j:[]; }
        catch{ return []; }
      }
      function showListModal(title, items, type){
        const modal = document.getElementById('listModal');
        const cont  = document.getElementById('listContainer');
        const titleEl = document.getElementById('listTitle');
        titleEl.textContent = title;
        cont.innerHTML = '';

        if (!Array.isArray(items) || !items.length){
          cont.innerHTML = '<div class="text-xs text-slate-500 dark:text-slate-400">No items found.</div>';
          modal.classList.add('is-open');
          return;
        }

        items.forEach(it=>{
          const row = document.createElement('div');
          row.className = 'list-row';

          // Title (clickable for ebooks)
          const h = document.createElement('div');
          h.className = 'list-title text-base sm:text-lg';
          if (type === 'ebooks' && it.link){
            const a = document.createElement('a');
            a.href = it.link; a.target = '_blank'; a.rel = 'noopener';
            a.className = 'hover:underline text-cyan-700 dark:text-cyan-400';
            a.textContent = it.title || '(Untitled)';
            h.appendChild(a);
          } else {
            h.textContent = it.title || '(Untitled)';
          }
          row.appendChild(h);

          // Meta bullets
          const metaList = document.createElement('ul');
          metaList.className = 'list-meta mt-1 space-y-0.5';
          const meta = [
            ['Authors',   it.authors],
            ['Publisher', it.publisher],
            ['Edition',   it.edition],
            ['Category',  it.category],
            ['Language',  it.language],
            ['Level',     it.level],
          ];
          meta.forEach(([k,v])=>{
            if (!v) return;
            const li = document.createElement('li');
            const val = Array.isArray(v) ? v.join(', ') : v;
            li.innerHTML = `<b>${k}:</b> ${val}`;
            metaList.appendChild(li);
          });
          row.appendChild(metaList);

          cont.appendChild(row);
        });

        modal.classList.add('is-open');
      }

      /* ===================== boot ===================== */
      window.addEventListener('error', e=> console.error('App error:', e.error || e.message));
      document.addEventListener('DOMContentLoaded', async () => {
        try{
          // theme
          const pref = localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
          applyTheme(pref);
          $('#modeBtn')?.addEventListener('click', ()=>{ const next = document.documentElement.classList.contains('dark')?'light':'dark'; applyTheme(next); });

          // data
          const remote = await loadRemote();
          const local  = loadLocal();
          state.data   = Array.isArray(remote) ? [...remote, ...local] : local;

          // routing
          const h = parseHash(); state.query=h.q; state.category=h.cat; state.route=h.route;
          $('#search')?.value = state.query;

          // controls
          $('#search')?.addEventListener('input', e=>{ state.query=e.target.value; setHash({ q: state.query }); render(); });
          await initCategoryDropdown();
          $$('.route-btn').forEach(btn=> btn.addEventListener('click', ()=>{
            state.route = btn.dataset.route;
            setHash({ route: state.route, q: state.query, cat: state.category });
            render();
          }));
          window.addEventListener('hashchange', ()=>{
            const h=parseHash(); state.query=h.q; state.category=h.cat; state.route=h.route;
            $('#search') && ($('#search').value = state.query); render();
          });

          // add form
          $('#addForm')?.addEventListener('submit', e=>{
            e.preventDefault();
            const fd = new FormData(e.target);
            const item = Object.fromEntries(fd.entries());
            item.tags = (item.tags||'').split(',').map(s=>s.trim()).filter(Boolean);
            state.data.unshift(item);
            save(state.data);
            e.target.reset();
            render();
            location.hash = '#'+new URLSearchParams({route:'links', cat:state.category, q:state.query}).toString();
          });

          // About modal close
          $('#aboutClose')?.addEventListener('click', ()=> document.getElementById('aboutModal')?.classList.remove('is-open'));
          $('#aboutModal')?.addEventListener('click', (e)=>{ if(e.target.id==='aboutModal') e.currentTarget.classList.remove('is-open'); });

          // List modal close
          $('#listClose')?.addEventListener('click', ()=> document.getElementById('listModal')?.classList.remove('is-open'));
          $('#listModal')?.addEventListener('click', (e)=>{ if(e.target.id==='listModal') e.currentTarget.classList.remove('is-open'); });

          // ESC closes any open modal
          document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ document.querySelectorAll('.modal.is-open').forEach(m=>m.classList.remove('is-open')); } });

          // i18n (default EN)
          setLang(state.lang);
          $('#langBtn')?.addEventListener('click', ()=> setLang(state.lang==='fa' ? 'en' : 'fa'));

          // featured clicks
          document.getElementById('featured-books')?.addEventListener('click', async ()=>{
            const data = await getJSON('books.json');
            showListModal('Books List', data||[], 'books');
          });
          document.getElementById('featured-ebooks')?.addEventListener('click', async ()=>{
            const data = await getJSON('ebooks.json');
            showListModal('Ebooks', data||[], 'ebooks');
          });

          // initial render
          render();
        }catch(err){
          console.error(err);
        }
      });
    </script>
  </body>
</html>
